### Домашнее задание 9. Хранимые процедуры

В базе данных `Airline` информация о рейсах самолётов задана в виде таблиц

```sql
Flights(
    FlightId integer, 
    FlightTime timestamp, 
    PlaneId integer,
    -- Дополнительные столбцы, при необходимости
)
Seats(
    PlaneId integer,
    SeatNo varchar(4), -- 123A
    -- Дополнительные столбцы, при необходимости
)
```

Реализуйте запросы к базе данных `Airline` с применением представлений, хранимых процедур и функций. При необходимости, вы можете создать дополнительные таблицы, представления и хранимые процедуры.

0. Prologue
    1. Укажите название и версию СУБД, для которой вы писали хранимые процедуры

       PostgreSQL 12.9
    2. Таблицы и представления

       Укажите определения таблиц (в том числе, указанных в условии) и представлений, созданных в рамках ДЗ. Описание таблиц и представлений укажите в комментариях к ним
    3. Дополнительные процедуры

       Укажите определения дополнительных хранимых процедур, созданных в рамках ДЗ. Описание процедур укажите в комментариях к ним
1. `FreeSeats(FlightId)` — список мест, доступных для продажи и для бронирования.
2. `Reserve(UserId, Pass, FlightId, SeatNo)` — пытается забронировать место на трое суток начиная с момента бронирования. Возвращает _истину_, если удалось и _ложь_ — в противном случае.
3. `ExtendReservation(UserId, Pass, FlightId, SeatNo)` — пытается продлить бронь места на трое суток начиная с момента продления. Возвращает _истину_, если удалось и _ложь_ — в противном случае.
4. `BuyFree(FlightId, SeatNo)` — пытается купить свободное место. Возвращает _истину_, если удалось и _ложь_ — в противном случае.
5. `BuyReserved(UserId, Pass, FlightId, SeatNo)` — пытается выкупить забронированное место (пользователи должны совпадать). Возвращает _истину_, если удалось и _ложь_ — в противном случае.
6. `FlightsStatistics(UserId, Pass)` — статистика по рейсам: возможность бронирования и покупки, число свободных, забронированных и проданных мест.
7. `FlightStat(UserId, Pass, FlightId)` — статистика по рейсу: возможность бронирования и покупки, число свободных, забронированных и проданных мест.
8. `CompressSeats(FlightId)` — оптимизирует занятость мест в самолете. В результате оптимизации, в начале самолета должны быть купленные места, затем — забронированные, а в конце — свободные. Примечание: клиенты, которые уже выкупили билеты также должны быть пересажены.

[Форма для сдачи ДЗ](https://docs.google.com/forms/d/e/1FAIpQLSdvfD-BX6f3M-LNVX_4ZiNRm2YjcONxHmvGT5UMrlfCDDq2-A/viewform)

В рамках проекта:

1.  Определите храниемые процедуры и функции, необходимые для работы проекта.
2.  Реализуйте хранимые процедуры (функций) на языке SQL.

### Минусы

0. Prologue
    1. Укажите название и версию СУБД, для которой вы писали хранимые процедуры
    2. Таблицы и представления
    3. Дополнительные процедуры
1. FreeSeats
2. Reserve

    · Использование if ... then update else insert вместо upsert
3. ExtendReservation
4. BuyFree
5. BuyReserved
6. FlightsStatistics

   · Множественные скалярные запросы вместо join+агрегация
7. FlightsStat
8. CompressSeats

   ·
